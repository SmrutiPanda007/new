/*!
 * Pusher JavaScript Library v2.1.6
 * http://pusherapp.com/
 *
 * Copyright 2013, Pusher
 * Released under the MIT licence.
 */
(function(){function n(t,i){(t===null||t===void 0)&&n.warn("Warning","You must pass your app key when you instantiate Pusher.");var i=i||{},r=this;this.key=t;this.config=n.Util.extend(n.getGlobalConfig(),i.cluster?n.getClusterConfig(i.cluster):{},i);this.channels=new n.Channels;this.global_emitter=new n.EventsDispatcher;this.sessionID=Math.floor(Math.random()*1e9);this.timeline=new n.Timeline(this.key,this.sessionID,{features:n.Util.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:n.Timeline.INFO,version:n.VERSION});this.config.disableStats||(this.timelineSender=new n.TimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline"}));this.connection=new n.ConnectionManager(this.key,n.Util.extend({getStrategy:function(t){return n.StrategyBuilder.build(n.getDefaultStrategy(r.config),n.Util.extend({},r.config,t))},timeline:this.timeline,activityTimeout:this.config.activity_timeout,pongTimeout:this.config.pong_timeout,unavailableTimeout:this.config.unavailable_timeout},this.config,{encrypted:this.isEncrypted()}));this.connection.bind("connected",function(){r.subscribeAll();r.timelineSender&&r.timelineSender.send(r.connection.isEncrypted())});this.connection.bind("message",function(n){var i=n.event.indexOf("pusher_internal:")===0,t;n.channel&&(t=r.channel(n.channel),t&&t.handleEvent(n.event,n.data));i||r.global_emitter.emit(n.event,n.data)});this.connection.bind("disconnected",function(){r.channels.disconnect()});this.connection.bind("error",function(t){n.warn("Error",t)});n.instances.push(this);this.timeline.info({instances:n.instances.length});n.isReady&&r.connect()}var t=n.prototype;n.instances=[];n.isReady=!1;n.debug=function(){n.log&&n.log(n.Util.stringify.apply(this,arguments))};n.warn=function(){var t=n.Util.stringify.apply(this,arguments);window.console&&(window.console.warn?window.console.warn(t):window.console.log&&window.console.log(t));n.log&&n.log(t)};n.ready=function(){n.isReady=!0;for(var t=0,i=n.instances.length;t<i;t++)n.instances[t].connect()};t.channel=function(n){return this.channels.find(n)};t.allChannels=function(){return this.channels.all()};t.connect=function(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var t=this.connection.isEncrypted(),i=this.timelineSender;this.timelineSenderTimer=new n.PeriodicTimer(6e4,function(){i.send(t)})}};t.disconnect=function(){this.connection.disconnect();this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)};t.bind=function(n,t){return this.global_emitter.bind(n,t),this};t.bind_all=function(n){return this.global_emitter.bind_all(n),this};t.subscribeAll=function(){for(var n in this.channels.channels)this.channels.channels.hasOwnProperty(n)&&this.subscribe(n)};t.subscribe=function(n){return n=this.channels.add(n,this),this.connection.state==="connected"&&n.subscribe(),n};t.unsubscribe=function(n){n=this.channels.remove(n);this.connection.state==="connected"&&n.unsubscribe()};t.send_event=function(n,t,i){return this.connection.send_event(n,t,i)};t.isEncrypted=function(){return n.Util.getDocumentLocation().protocol==="https:"?!0:Boolean(this.config.encrypted)};this.Pusher=n}).call(this),function(){function n(n,t){var i=this;this.timeout=setTimeout(function(){i.timeout!==null&&(t(),i.timeout=null)},n)}var t=n.prototype;t.isRunning=function(){return this.timeout!==null};t.ensureAborted=function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)};Pusher.Timer=n}.call(this),function(){function n(n,t){var i=this;this.interval=setInterval(function(){i.interval!==null&&t()},n)}var t=n.prototype;t.isRunning=function(){return this.interval!==null};t.ensureAborted=function(){this.interval&&(clearInterval(this.interval),this.interval=null)};Pusher.PeriodicTimer=n}.call(this),function(){Pusher.Util={now:function(){return Date.now?Date.now():(new Date).valueOf()},defer:function(n){return new Pusher.Timer(0,n)},extend:function(n){for(var i,t,r=1;r<arguments.length;r++){i=arguments[r];for(t in i)n[t]=i[t]&&i[t].constructor&&i[t].constructor===Object?Pusher.Util.extend(n[t]||{},i[t]):i[t]}return n},stringify:function(){for(var t=["Pusher"],n=0;n<arguments.length;n++)typeof arguments[n]=="string"?t.push(arguments[n]):window.JSON===void 0?t.push(arguments[n].toString()):t.push(JSON.stringify(arguments[n]));return t.join(" : ")},arrayIndexOf:function(n,t){var i=Array.prototype.indexOf,r;if(n===null)return-1;if(i&&n.indexOf===i)return n.indexOf(t);for(i=0,r=n.length;i<r;i++)if(n[i]===t)return i;return-1},objectApply:function(n,t){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t(n[i],i,n)},keys:function(n){var t=[];return Pusher.Util.objectApply(n,function(n,i){t.push(i)}),t},values:function(n){var t=[];return Pusher.Util.objectApply(n,function(n){t.push(n)}),t},apply:function(n,t){for(var i=0;i<n.length;i++)t(n[i],i,n)},map:function(n,t){for(var r=[],i=0;i<n.length;i++)r.push(t(n[i],i,n,r));return r},mapObject:function(n,t){var i={};return Pusher.Util.objectApply(n,function(n,r){i[r]=t(n)}),i},filter:function(n,t){for(var t=t||function(n){return!!n},r=[],i=0;i<n.length;i++)t(n[i],i,n,r)&&r.push(n[i]);return r},filterObject:function(n,t){var i={};return Pusher.Util.objectApply(n,function(r,u){(t&&t(r,u,n,i)||Boolean(r))&&(i[u]=r)}),i},flatten:function(n){var t=[];return Pusher.Util.objectApply(n,function(n,i){t.push([i,n])}),t},any:function(n,t){for(var i=0;i<n.length;i++)if(t(n[i],i,n))return!0;return!1},all:function(n,t){for(var i=0;i<n.length;i++)if(!t(n[i],i,n))return!1;return!0},method:function(n){var t=Array.prototype.slice.call(arguments,1);return function(i){return i[n].apply(i,t.concat(arguments))}},getDocument:function(){return document},getDocumentLocation:function(){return Pusher.Util.getDocument().location},getLocalStorage:function(){try{return window.localStorage}catch(n){}},getClientFeatures:function(){return Pusher.Util.keys(Pusher.Util.filterObject({ws:Pusher.WSTransport,flash:Pusher.FlashTransport},function(n){return n.isSupported()}))}}}.call(this),function(){Pusher.VERSION="2.1.6";Pusher.PROTOCOL=7;Pusher.host="ws.pusherapp.com";Pusher.ws_port=80;Pusher.wss_port=443;Pusher.sockjs_host="sockjs.pusher.com";Pusher.sockjs_http_port=80;Pusher.sockjs_https_port=443;Pusher.sockjs_path="/pusher";Pusher.stats_host="stats.pusher.com";Pusher.channel_auth_endpoint="/pusher/auth";Pusher.channel_auth_transport="ajax";Pusher.activity_timeout=12e4;Pusher.pong_timeout=3e4;Pusher.unavailable_timeout=1e4;Pusher.cdn_http="http://js.pusher.com/";Pusher.cdn_https="https://d3dy5gmtp8yhk7.cloudfront.net/";Pusher.dependency_suffix=".min";Pusher.getDefaultStrategy=function(n){return[[":def","ws_options",{hostUnencrypted:n.wsHost+":"+n.wsPort,hostEncrypted:n.wsHost+":"+n.wssPort}],[":def","sockjs_options",{hostUnencrypted:n.httpHost+":"+n.httpPort,hostEncrypted:n.httpHost+":"+n.httpsPort}],[":def","timeouts",{loop:!0,timeout:15e3,timeoutLimit:6e4}],[":def","ws_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:n.activity_timeout}]],[":def_transport","ws","ws",3,":ws_options",":ws_manager"],[":def_transport","flash","flash",2,":ws_options",":ws_manager"],[":def_transport","sockjs","sockjs",1,":sockjs_options"],[":def","ws_loop",[":sequential",":timeouts",":ws"]],[":def","flash_loop",[":sequential",":timeouts",":flash"]],[":def","sockjs_loop",[":sequential",":timeouts",":sockjs"]],[":def","strategy",[":cached",18e5,[":first_connected",[":if",[":is_supported",":ws"],[":best_connected_ever",":ws_loop",[":delayed",2e3,[":sockjs_loop"]]],[":if",[":is_supported",":flash"],[":best_connected_ever",":flash_loop",[":delayed",2e3,[":sockjs_loop"]]],[":sockjs_loop"]]]]]]]}}.call(this),function(){Pusher.getGlobalConfig=function(){return{wsHost:Pusher.host,wsPort:Pusher.ws_port,wssPort:Pusher.wss_port,httpHost:Pusher.sockjs_host,httpPort:Pusher.sockjs_http_port,httpsPort:Pusher.sockjs_https_port,httpPath:Pusher.sockjs_path,statsHost:Pusher.stats_host,authEndpoint:Pusher.channel_auth_endpoint,authTransport:Pusher.channel_auth_transport,activity_timeout:Pusher.activity_timeout,pong_timeout:Pusher.pong_timeout,unavailable_timeout:Pusher.unavailable_timeout}};Pusher.getClusterConfig=function(n){return{wsHost:"ws-"+n+".pusher.com",httpHost:"sockjs-"+n+".pusher.com"}}}.call(this),function(){function n(n){var t=function(t){Error.call(this,t);this.name=n};return Pusher.Util.extend(t.prototype,Error.prototype),t}Pusher.Errors={BadEventName:n("BadEventName"),UnsupportedTransport:n("UnsupportedTransport"),UnsupportedStrategy:n("UnsupportedStrategy"),TransportPriorityTooLow:n("TransportPriorityTooLow"),TransportClosed:n("TransportClosed")}}.call(this),function(){function i(t){this.callbacks=new n;this.global_callbacks=[];this.failThrough=t}function n(){this._callbacks={}}var t=i.prototype;t.bind=function(n,t){return this.callbacks.add(n,t),this};t.bind_all=function(n){return this.global_callbacks.push(n),this};t.unbind=function(n,t){return this.callbacks.remove(n,t),this};t.emit=function(n,t){for(var r,i=0;i<this.global_callbacks.length;i++)this.global_callbacks[i](n,t);if(r=this.callbacks.get(n),r&&r.length>0)for(i=0;i<r.length;i++)r[i](t);else this.failThrough&&this.failThrough(n,t);return this};n.prototype.get=function(n){return this._callbacks[this._prefix(n)]};n.prototype.add=function(n,t){var i=this._prefix(n);this._callbacks[i]=this._callbacks[i]||[];this._callbacks[i].push(t)};n.prototype.remove=function(n,t){var i,r;this.get(n)&&(i=Pusher.Util.arrayIndexOf(this.get(n),t),i!==-1&&(r=this._callbacks[this._prefix(n)].slice(0),r.splice(i,1),this._callbacks[this._prefix(n)]=r))};n.prototype._prefix=function(n){return"_"+n};Pusher.EventsDispatcher=i}.call(this),function(){function t(n){this.options=n;this.loading={};this.loaded={}}function i(n,t){Pusher.Util.getDocument().addEventListener?n.addEventListener("load",t,!1):n.attachEvent("onreadystatechange",function(){(n.readyState==="loaded"||n.readyState==="complete")&&t()})}function r(n,t){var r=Pusher.Util.getDocument(),u=r.getElementsByTagName("head")[0],r=r.createElement("script");r.setAttribute("src",n);r.setAttribute("type","text/javascript");r.setAttribute("async",!0);i(r,function(){setTimeout(t,0)});u.appendChild(r)}var n=t.prototype;n.load=function(n,t){var i=this;this.loaded[n]?t():this.loading[n]&&this.loading[n].length>0?this.loading[n].push(t):(this.loading[n]=[t],r(this.getPath(n),function(){if(i.loaded[n]=!0,i.loading[n]){for(var t=0;t<i.loading[n].length;t++)i.loading[n][t]();delete i.loading[n]}}))};n.getRoot=function(n){var t=Pusher.Util.getDocumentLocation().protocol;return(n&&n.encrypted||t==="https:"?this.options.cdn_https:this.options.cdn_http).replace(/\/*$/,"")+"/"+this.options.version};n.getPath=function(n,t){return this.getRoot(t)+"/"+n+this.options.suffix+".js"};Pusher.DependencyLoader=t}.call(this),function(){function i(){Pusher.ready()}function n(t){document.body?t():setTimeout(function(){n(t)},0)}function t(){n(i)}Pusher.Dependencies=new Pusher.DependencyLoader({cdn_http:Pusher.cdn_http,cdn_https:Pusher.cdn_https,version:Pusher.VERSION,suffix:Pusher.dependency_suffix});!window.WebSocket&&window.MozWebSocket&&(window.WebSocket=window.MozWebSocket);window.JSON?t():Pusher.Dependencies.load("json2",t)}(),function(){for(var n=String.fromCharCode,t=0;t<64;t++)"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t);var i=function(t){var i=t.charCodeAt(0);return i<128?t:i<2048?n(192|i>>>6)+n(128|i&63):n(224|i>>>12&15)+n(128|i>>>6&63)+n(128|i&63)},r=function(n){var t=[0,2,1][n.length%3],n=n.charCodeAt(0)<<16|(n.length>1?n.charCodeAt(1):0)<<8|(n.length>2?n.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>12&63),t>=2?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>6&63),t>=1?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n&63)].join("")},u=window.btoa||function(n){return n.replace(/[\s\S]{1,3}/g,r)};Pusher.Base64={encode:function(n){return u(n.replace(/[^\x00-\x7F]/g,i))}}}.call(this),function(){function n(n){this.options=n}function i(n){return Pusher.Util.mapObject(n,function(n){return typeof n=="object"&&(n=JSON.stringify(n)),encodeURIComponent(Pusher.Base64.encode(n.toString()))})}n.send=function(n,t){var i=new Pusher.JSONPRequest({url:n.url,receiver:n.receiverName,tagPrefix:n.tagPrefix}),r=n.receiver.register(function(n,r){i.cleanup();t(n,r)});return i.send(r,n.data,function(t){var i=n.receiver.unregister(r);i&&i(t)})};var t=n.prototype;t.send=function(n,t,r){var f;if(this.script)return!1;var u=this.options.tagPrefix||"_pusher_jsonp_",t=Pusher.Util.extend({},t,{receiver:this.options.receiver}),t=Pusher.Util.map(Pusher.Util.flatten(i(Pusher.Util.filterObject(t,function(n){return n!==void 0}))),Pusher.Util.method("join","=")).join("&");return this.script=document.createElement("script"),this.script.id=u+n,this.script.src=this.options.url+"/"+n+"?"+t,this.script.type="text/javascript",this.script.charset="UTF-8",this.script.onerror=this.script.onload=r,this.script.async===void 0&&document.attachEvent&&/opera/i.test(navigator.userAgent)&&(u=this.options.receiver||"Pusher.JSONP.receive",this.errorScript=document.createElement("script"),this.errorScript.text=u+"("+n+", true);",this.script.async=this.errorScript.async=!1),f=this,this.script.onreadystatechange=function(){f.script&&/loaded|complete/.test(f.script.readyState)&&r(!0)},n=document.getElementsByTagName("head")[0],n.insertBefore(this.script,n.firstChild),this.errorScript&&n.insertBefore(this.errorScript,this.script.nextSibling),!0};t.cleanup=function(){this.script&&this.script.parentNode&&(this.script.parentNode.removeChild(this.script),this.script=null);this.errorScript&&this.errorScript.parentNode&&(this.errorScript.parentNode.removeChild(this.errorScript),this.errorScript=null)};Pusher.JSONPRequest=n}.call(this),function(){function n(){this.lastId=0;this.callbacks={}}var t=n.prototype;t.register=function(n){this.lastId++;var t=this.lastId;return this.callbacks[t]=n,t};t.unregister=function(n){if(this.callbacks[n]){var t=this.callbacks[n];return delete this.callbacks[n],t}return null};t.receive=function(n,t,i){(n=this.unregister(n))&&n(t,i)};Pusher.JSONPReceiver=n;Pusher.JSONP=new n}.call(this),function(){function n(n,t,i){this.key=n;this.session=t;this.events=[];this.options=i||{};this.uniqueID=this.sent=0}var t=n.prototype;n.ERROR=3;n.INFO=6;n.DEBUG=7;t.log=function(t,i){(this.options.level===void 0||t<=this.options.level)&&(this.events.push(Pusher.Util.extend({},i,{timestamp:Pusher.Util.now(),level:t!==n.INFO?t:void 0})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())};t.error=function(t){this.log(n.ERROR,t)};t.info=function(t){this.log(n.INFO,t)};t.debug=function(t){this.log(n.DEBUG,t)};t.isEmpty=function(){return this.events.length===0};t.send=function(n,t){var i=this,r=Pusher.Util.extend({session:i.session,bundle:i.sent+1,key:i.key,lib:"js",version:i.options.version,features:i.options.features,timeline:i.events},i.options.params);return i.events=[],n(r,function(n,r){n||i.sent++;t&&t(n,r)}),!0};t.generateUniqueID=function(){return this.uniqueID++,this.uniqueID};Pusher.Timeline=n}.call(this),function(){function n(n,t){this.timeline=n;this.options=t||{}}n.prototype.send=function(n,t){if(!this.timeline.isEmpty()){var i=this,r="http"+(n?"s":"")+"://";i.timeline.send(function(n,t){var u={data:Pusher.Util.filterObject(n,function(n){return n!==void 0}),url:r+(i.host||i.options.host)+i.options.path,receiver:Pusher.JSONP};return Pusher.JSONPRequest.send(u,function(n,r){r&&r.host&&(i.host=r.host);t&&t(n,r)})},t)}};Pusher.TimelineSender=n}.call(this),function(){function n(n){this.strategies=n}function i(n,t,i){var r=Pusher.Util.map(n,function(n,r,u,f){return n.connect(t,i(r,f))});return{abort:function(){Pusher.Util.apply(r,u)},forceMinPriority:function(n){Pusher.Util.apply(r,function(t){t.forceMinPriority(n)})}}}function r(n){return Pusher.Util.all(n,function(n){return Boolean(n.error)})}function u(n){n.error||n.aborted||(n.abort(),n.aborted=!0)}var t=n.prototype;t.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))};t.connect=function(n,t){return i(this.strategies,n,function(n,i){return function(u,f){(i[n].error=u)?r(i)&&t(!0):(Pusher.Util.apply(i,function(n){n.forceMinPriority(f.transport.priority)}),t(null,f))}})};Pusher.BestConnectedEverStrategy=n}.call(this),function(){function t(n,t,i){this.strategy=n;this.transports=t;this.ttl=i.ttl||18e5;this.encrypted=i.encrypted;this.timeline=i.timeline}function n(n){return"pusherTransport"+(n?"Encrypted":"Unencrypted")}function u(t){var u=Pusher.Util.getLocalStorage(),r;if(u)try{if(r=u[n(t)],r)return JSON.parse(r)}catch(f){i(t)}return null}function i(t){var i=Pusher.Util.getLocalStorage();if(i)try{delete i[n(t)]}catch(r){}}var r=t.prototype;r.isSupported=function(){return this.strategy.isSupported()};r.connect=function(t,r){var s=this.encrypted,f=u(s),o=[this.strategy],h,c,e;return f&&f.timestamp+this.ttl>=Pusher.Util.now()&&(h=this.transports[f.transport],h&&(this.timeline.info({cached:!0,transport:f.transport}),o.push(new Pusher.SequentialStrategy([h],{timeout:f.latency*2,failFast:!0})))),c=Pusher.Util.now(),e=o.pop().connect(t,function l(u,f){if(u)i(s),o.length>0?(c=Pusher.Util.now(),e=o.pop().connect(t,l)):r(u);else{var a=f.transport.name,v=Pusher.Util.now()-c,h=Pusher.Util.getLocalStorage();if(h)try{h[n(s)]=JSON.stringify({timestamp:Pusher.Util.now(),transport:a,latency:v})}catch(y){}r(null,f)}}),{abort:function(){e.abort()},forceMinPriority:function(n){t=n;e&&e.forceMinPriority(n)}}};Pusher.CachedStrategy=t}.call(this),function(){function n(n,t){this.strategy=n;this.options={delay:t.delay}}var t=n.prototype;t.isSupported=function(){return this.strategy.isSupported()};t.connect=function(n,t){var r=this.strategy,i,u=new Pusher.Timer(this.options.delay,function(){i=r.connect(n,t)});return{abort:function(){u.ensureAborted();i&&i.abort()},forceMinPriority:function(t){n=t;i&&i.forceMinPriority(t)}}};Pusher.DelayedStrategy=n}.call(this),function(){function n(n){this.strategy=n}var t=n.prototype;t.isSupported=function(){return this.strategy.isSupported()};t.connect=function(n,t){var i=this.strategy.connect(n,function(n,r){r&&i.abort();t(n,r)});return i};Pusher.FirstConnectedStrategy=n}.call(this),function(){function n(n,t,i){this.test=n;this.trueBranch=t;this.falseBranch=i}var t=n.prototype;t.isSupported=function(){return(this.test()?this.trueBranch:this.falseBranch).isSupported()};t.connect=function(n,t){return(this.test()?this.trueBranch:this.falseBranch).connect(n,t)};Pusher.IfStrategy=n}.call(this),function(){function t(n,t){this.strategies=n;this.loop=Boolean(t.loop);this.failFast=Boolean(t.failFast);this.timeout=t.timeout;this.timeoutLimit=t.timeoutLimit}var n=t.prototype;n.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))};n.connect=function(n,t){var r=this,f=this.strategies,u=0,i=this.timeout,e=null,o=function(s,h){h?t(null,h):(u+=1,r.loop&&(u%=f.length),u<f.length?(i&&(i*=2,r.timeoutLimit&&(i=Math.min(i,r.timeoutLimit))),e=r.tryStrategy(f[u],n,{timeout:i,failFast:r.failFast},o)):t(!0))},e=this.tryStrategy(f[u],n,{timeout:i,failFast:this.failFast},o);return{abort:function(){e.abort()},forceMinPriority:function(t){n=t;e&&e.forceMinPriority(t)}}};n.tryStrategy=function(n,t,i,r){var u=null,f=null;return i.timeout>0&&(u=new Pusher.Timer(i.timeout,function(){f.abort();r(!0)})),f=n.connect(t,function(n,t){n&&u&&u.isRunning()&&!i.failFast||(u&&u.ensureAborted(),r(n,t))}),{abort:function(){u&&u.ensureAborted();f.abort()},forceMinPriority:function(n){f.forceMinPriority(n)}}};Pusher.SequentialStrategy=t}.call(this),function(){function n(n,t,i,r){this.name=n;this.priority=t;this.transport=i;this.options=r||{}}function t(n,t){return Pusher.Util.defer(function(){t(n)}),{abort:function(){},forceMinPriority:function(){}}}var i=n.prototype;i.isSupported=function(){return this.transport.isSupported()};i.connect=function(n,i){if(this.isSupported()){if(this.priority<n)return t(new Pusher.Errors.TransportPriorityTooLow,i)}else return t(new Pusher.Errors.UnsupportedStrategy,i);var l=this,e=!1,r=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),u=null,o=function(){r.unbind("initialized",o);r.connect()},s=function(){u=new Pusher.Handshake(r,function(n){e=!0;f();i(null,n)})},h=function(n){f();i(n)},c=function(){f();i(new Pusher.Errors.TransportClosed(r))},f=function(){r.unbind("initialized",o);r.unbind("open",s);r.unbind("error",h);r.unbind("closed",c)};return r.bind("initialized",o),r.bind("open",s),r.bind("error",h),r.bind("closed",c),r.initialize(),{abort:function(){e||(f(),u?u.close():r.close())},forceMinPriority:function(n){e||l.priority<n&&(u?u.close():r.close())}}};Pusher.TransportStrategy=n}.call(this),function(){function t(n,t,i,r){Pusher.EventsDispatcher.call(this);this.name=n;this.priority=t;this.key=i;this.state="new";this.timeline=r.timeline;this.activityTimeout=r.activityTimeout;this.id=this.timeline.generateUniqueID();this.options={encrypted:Boolean(r.encrypted),hostUnencrypted:r.hostUnencrypted,hostEncrypted:r.hostEncrypted}}var n=t.prototype;Pusher.Util.extend(n,Pusher.EventsDispatcher.prototype);t.isSupported=function(){return!1};n.supportsPing=function(){return!1};n.initialize=function(){this.timeline.info(this.buildTimelineMessage({transport:this.name+(this.options.encrypted?"s":"")}));this.timeline.debug(this.buildTimelineMessage({method:"initialize"}));this.changeState("initialized")};n.connect=function(){var n=this.getURL(this.key,this.options),t;if(this.timeline.debug(this.buildTimelineMessage({method:"connect",url:n})),this.socket||this.state!=="initialized")return!1;try{this.socket=this.createSocket(n)}catch(i){return t=this,Pusher.Util.defer(function(){t.onError(i);t.changeState("closed")}),!1}return this.bindListeners(),Pusher.debug("Connecting",{transport:this.name,url:n}),this.changeState("connecting"),!0};n.close=function(){return this.timeline.debug(this.buildTimelineMessage({method:"close"})),this.socket?(this.socket.close(),!0):!1};n.send=function(n){if(this.timeline.debug(this.buildTimelineMessage({method:"send",data:n})),this.state==="open"){var t=this;return setTimeout(function(){t.socket&&t.socket.send(n)},0),!0}return!1};n.onOpen=function(){this.changeState("open");this.socket.onopen=void 0};n.onError=function(n){this.emit("error",{type:"WebSocketError",error:n});this.timeline.error(this.buildTimelineMessage({}))};n.onClose=function(n){n?this.changeState("closed",{code:n.code,reason:n.reason,wasClean:n.wasClean}):this.changeState("closed");this.socket=void 0};n.onMessage=function(n){this.timeline.debug(this.buildTimelineMessage({message:n.data}));this.emit("message",n)};n.bindListeners=function(){var n=this;this.socket.onopen=function(){n.onOpen()};this.socket.onerror=function(t){n.onError(t)};this.socket.onclose=function(t){n.onClose(t)};this.socket.onmessage=function(t){n.onMessage(t)}};n.createSocket=function(){return null};n.getScheme=function(){return this.options.encrypted?"wss":"ws"};n.getBaseURL=function(){var n;return n=this.options.encrypted?this.options.hostEncrypted:this.options.hostUnencrypted,this.getScheme()+"://"+n};n.getPath=function(){return"/app/"+this.key};n.getQueryString=function(){return"?protocol="+Pusher.PROTOCOL+"&client=js&version="+Pusher.VERSION};n.getURL=function(){return this.getBaseURL()+this.getPath()+this.getQueryString()};n.changeState=function(n,t){this.state=n;this.timeline.info(this.buildTimelineMessage({state:n,params:t}));this.emit(n,t)};n.buildTimelineMessage=function(n){return Pusher.Util.extend({cid:this.id},n)};Pusher.AbstractTransport=t}.call(this),function(){function n(n,t,i,r){Pusher.AbstractTransport.call(this,n,t,i,r)}var t=n.prototype;Pusher.Util.extend(t,Pusher.AbstractTransport.prototype);n.createConnection=function(t,i,r,u){return new n(t,i,r,u)};n.isSupported=function(){try{return Boolean(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(n){try{return Boolean(navigator&&navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]!==void 0)}catch(t){return!1}}};t.initialize=function(){var n=this;this.timeline.info(this.buildTimelineMessage({transport:this.name+(this.options.encrypted?"s":"")}));this.timeline.debug(this.buildTimelineMessage({method:"initialize"}));this.changeState("initializing");window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR===void 0&&(window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0);window.WEB_SOCKET_SWF_LOCATION=Pusher.Dependencies.getRoot()+"/WebSocketMain.swf";Pusher.Dependencies.load("flashfallback",function(){n.changeState("initialized")})};t.createSocket=function(n){return new FlashWebSocket(n)};t.getQueryString=function(){return Pusher.AbstractTransport.prototype.getQueryString.call(this)+"&flash=true"};Pusher.FlashTransport=n}.call(this),function(){function t(n,t,i,r){Pusher.AbstractTransport.call(this,n,t,i,r);this.options.ignoreNullOrigin=r.ignoreNullOrigin}var n=t.prototype;Pusher.Util.extend(n,Pusher.AbstractTransport.prototype);t.createConnection=function(n,i,r,u){return new t(n,i,r,u)};t.isSupported=function(){return!0};n.initialize=function(){var n=this;this.timeline.info(this.buildTimelineMessage({transport:this.name+(this.options.encrypted?"s":"")}));this.timeline.debug(this.buildTimelineMessage({method:"initialize"}));this.changeState("initializing");Pusher.Dependencies.load("sockjs",function(){n.changeState("initialized")})};n.supportsPing=function(){return!0};n.createSocket=function(n){return new SockJS(n,null,{js_path:Pusher.Dependencies.getPath("sockjs",{encrypted:this.options.encrypted}),ignore_null_origin:this.options.ignoreNullOrigin})};n.getScheme=function(){return this.options.encrypted?"https":"http"};n.getPath=function(){return this.options.httpPath||"/pusher"};n.getQueryString=function(){return""};n.onOpen=function(){this.socket.send(JSON.stringify({path:Pusher.AbstractTransport.prototype.getPath.call(this)+Pusher.AbstractTransport.prototype.getQueryString.call(this)}));this.changeState("open");this.socket.onopen=void 0};Pusher.SockJSTransport=t}.call(this),function(){function n(n,t,i,r){Pusher.AbstractTransport.call(this,n,t,i,r)}var t=n.prototype;Pusher.Util.extend(t,Pusher.AbstractTransport.prototype);n.createConnection=function(t,i,r,u){return new n(t,i,r,u)};n.isSupported=function(){return window.WebSocket!==void 0||window.MozWebSocket!==void 0};t.createSocket=function(n){return new(window.WebSocket||window.MozWebSocket)(n)};t.getQueryString=function(){return Pusher.AbstractTransport.prototype.getQueryString.call(this)+"&flash=false"};Pusher.WSTransport=n}.call(this),function(){function n(n,t,i){this.manager=n;this.transport=t;this.minPingDelay=i.minPingDelay;this.maxPingDelay=i.maxPingDelay;this.pingDelay=void 0}var t=n.prototype;t.createConnection=function(n,t,i,r){var u=this,r=Pusher.Util.extend({},r,{activityTimeout:u.pingDelay}),f=u.transport.createConnection(n,t,i,r),e=null,o=function(){f.unbind("open",o);f.bind("closed",s);e=Pusher.Util.now()},s=function(n){f.unbind("closed",s);n.code===1002||n.code===1003?u.manager.reportDeath():!n.wasClean&&e&&(n=Pusher.Util.now()-e,n<2*u.maxPingDelay)&&(u.manager.reportDeath(),u.pingDelay=Math.max(n/2,u.minPingDelay))};return f.bind("open",o),f};t.isSupported=function(){return this.manager.isAlive()&&this.transport.isSupported()};Pusher.AssistantToTheTransportManager=n}.call(this),function(){function t(n){this.options=n||{};this.livesLeft=this.options.lives||Infinity}var n=t.prototype;n.getAssistant=function(n){return new Pusher.AssistantToTheTransportManager(this,n,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})};n.isAlive=function(){return this.livesLeft>0};n.reportDeath=function(){this.livesLeft-=1};Pusher.TransportManager=t}.call(this),function(){function n(n){return function(t){return[n.apply(this,arguments),t]}}function i(n,r){if(n.length===0)return[[],r];var u=t(n[0],r),f=i(n.slice(1),u[1]);return[[u[0]].concat(f[0]),f[1]]}function r(n,r){var u,f;if(typeof n[0]=="string"&&n[0].charAt(0)===":"){if(u=r[n[0].slice(1)],n.length>1){if(typeof u!="function")throw"Calling non-function "+n[0];return f=[Pusher.Util.extend({},r)].concat(Pusher.Util.map(n.slice(1),function(n){return t(n,Pusher.Util.extend({},r))[0]})),u.apply(this,f)}return[u,r]}return i(n,r)}function t(n,t){if(typeof n=="string"){var i;if(typeof n=="string"&&n.charAt(0)===":"){if(i=t[n.slice(1)],i===void 0)throw"Undefined symbol "+n;i=[i,t]}else i=[n,t];return i}return typeof n=="object"&&n instanceof Array&&n.length>0?r(n,t):[n,t]}var u={ws:Pusher.WSTransport,flash:Pusher.FlashTransport,sockjs:Pusher.SockJSTransport},f={isSupported:function(){return!1},connect:function(n,t){var i=Pusher.Util.defer(function(){t(new Pusher.Errors.UnsupportedStrategy)});return{abort:function(){i.ensureAborted()},forceMinPriority:function(){}}}},e={def:function(n,t,i){if(n[t]!==void 0)throw"Redefining symbol "+t;return n[t]=i,[void 0,n]},def_transport:function(n,t,i,r,e,o){var s=u[i];if(!s)throw new Pusher.Errors.UnsupportedTransport(i);return i=(!n.enabledTransports||Pusher.Util.arrayIndexOf(n.enabledTransports,t)!==-1)&&(!n.disabledTransports||Pusher.Util.arrayIndexOf(n.disabledTransports,t)===-1)&&(t!=="flash"||n.disableFlash!==!0)?new Pusher.TransportStrategy(t,r,o?o.getAssistant(s):s,Pusher.Util.extend({key:n.key,encrypted:n.encrypted,timeline:n.timeline,ignoreNullOrigin:n.ignoreNullOrigin},e)):f,r=n.def(n,t,i)[1],r.transports=n.transports||{},r.transports[t]=i,[void 0,r]},transport_manager:n(function(n,t){return new Pusher.TransportManager(t)}),sequential:n(function(n,t){var i=Array.prototype.slice.call(arguments,2);return new Pusher.SequentialStrategy(i,t)}),cached:n(function(n,t,i){return new Pusher.CachedStrategy(i,n.transports,{ttl:t,timeline:n.timeline,encrypted:n.encrypted})}),first_connected:n(function(n,t){return new Pusher.FirstConnectedStrategy(t)}),best_connected_ever:n(function(){var n=Array.prototype.slice.call(arguments,1);return new Pusher.BestConnectedEverStrategy(n)}),delayed:n(function(n,t,i){return new Pusher.DelayedStrategy(i,{delay:t})}),"if":n(function(n,t,i,r){return new Pusher.IfStrategy(t,i,r)}),is_supported:n(function(n,t){return function(){return t.isSupported()}})};Pusher.StrategyBuilder={build:function(n,i){var r=Pusher.Util.extend({},e,i);return t(n,r)[1].strategy}}}.call(this),function(){Pusher.Protocol={decodeMessage:function(n){try{var t=JSON.parse(n.data);if(typeof t.data=="string")try{t.data=JSON.parse(t.data)}catch(i){if(!(i instanceof SyntaxError))throw i;}return t}catch(r){throw{type:"MessageParseError",error:r,data:n.data};}},encodeMessage:function(n){return JSON.stringify(n)},processHandshake:function(n){if(n=this.decodeMessage(n),n.event==="pusher:connection_established"){if(!n.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:n.data.socket_id,activityTimeout:n.data.activity_timeout*1e3}}if(n.event==="pusher:error")return{action:this.getCloseAction(n.data),error:this.getCloseError(n.data)};throw"Invalid handshake";},getCloseAction:function(n){return n.code<4e3?n.code>=1002&&n.code<=1004?"backoff":null:n.code===4e3?"ssl_only":n.code<4100?"refused":n.code<4200?"backoff":n.code<4300?"retry":"refused"},getCloseError:function(n){return n.code!==1e3&&n.code!==1001?{type:"PusherError",data:{code:n.code,message:n.reason||n.message}}:null}}}.call(this),function(){function t(n,t){Pusher.EventsDispatcher.call(this);this.id=n;this.transport=t;this.activityTimeout=t.activityTimeout;this.bindListeners()}var n=t.prototype;Pusher.Util.extend(n,Pusher.EventsDispatcher.prototype);n.supportsPing=function(){return this.transport.supportsPing()};n.send=function(n){return this.transport.send(n)};n.send_event=function(n,t,i){return n={event:n,data:t},i&&(n.channel=i),Pusher.debug("Event sent",n),this.send(Pusher.Protocol.encodeMessage(n))};n.close=function(){this.transport.close()};n.bindListeners=function(){var n=this,t=function(t){var i;try{i=Pusher.Protocol.decodeMessage(t)}catch(r){n.emit("error",{type:"MessageParseError",error:r,data:t.data})}if(i!==void 0){Pusher.debug("Event recd",i);switch(i.event){case"pusher:error":n.emit("error",{type:"PusherError",data:i.data});break;case"pusher:ping":n.emit("ping");break;case"pusher:pong":n.emit("pong")}n.emit("message",i)}},i=function(t){n.emit("error",{type:"WebSocketError",error:t})},r=function(u){n.transport.unbind("closed",r);n.transport.unbind("error",i);n.transport.unbind("message",t);u&&u.code&&n.handleCloseEvent(u);n.transport=null;n.emit("closed")};n.transport.bind("message",t);n.transport.bind("error",i);n.transport.bind("closed",r)};n.handleCloseEvent=function(n){var t=Pusher.Protocol.getCloseAction(n);(n=Pusher.Protocol.getCloseError(n))&&this.emit("error",n);t&&this.emit(t)};Pusher.Connection=t}.call(this),function(){function t(n,t){this.transport=n;this.callback=t;this.bindListeners()}var n=t.prototype;n.close=function(){this.unbindListeners();this.transport.close()};n.bindListeners=function(){var n=this;n.onMessage=function(t){n.unbindListeners();try{var i=Pusher.Protocol.processHandshake(t);i.action==="connected"?n.finish("connected",{connection:new Pusher.Connection(i.id,n.transport),activityTimeout:i.activityTimeout}):(n.finish(i.action,{error:i.error}),n.transport.close())}catch(r){n.finish("error",{error:r});n.transport.close()}};n.onClosed=function(t){n.unbindListeners();var i=Pusher.Protocol.getCloseAction(t)||"backoff",t=Pusher.Protocol.getCloseError(t);n.finish(i,{error:t})};n.transport.bind("message",n.onMessage);n.transport.bind("closed",n.onClosed)};n.unbindListeners=function(){this.transport.unbind("message",this.onMessage);this.transport.unbind("closed",this.onClosed)};n.finish=function(n,t){this.callback(Pusher.Util.extend({transport:this.transport,action:n},t))};Pusher.Handshake=t}.call(this),function(){function t(n,t){Pusher.EventsDispatcher.call(this);this.key=n;this.options=t||{};this.state="initialized";this.connection=null;this.encrypted=!!t.encrypted;this.timeline=this.options.timeline;this.connectionCallbacks=this.buildConnectionCallbacks();this.errorCallbacks=this.buildErrorCallbacks();this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var i=this;Pusher.Network.bind("online",function(){i.timeline.info({netinfo:"online"});(i.state==="connecting"||i.state==="unavailable")&&i.retryIn(0)});Pusher.Network.bind("offline",function(){i.timeline.info({netinfo:"offline"});i.state==="connected"&&i.sendActivityCheck()});this.updateStrategy()}var n=t.prototype;Pusher.Util.extend(n,Pusher.EventsDispatcher.prototype);n.connect=function(){this.connection||this.runner||(this.strategy.isSupported()?(this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()):this.updateState("failed"))};n.send=function(n){return this.connection?this.connection.send(n):!1};n.send_event=function(n,t,i){return this.connection?this.connection.send_event(n,t,i):!1};n.disconnect=function(){this.disconnectInternally();this.updateState("disconnected")};n.isEncrypted=function(){return this.encrypted};n.startConnecting=function(){var n=this,t=function(i,r){i?n.runner=n.strategy.connect(0,t):r.action==="error"?(n.emit("error",{type:"HandshakeError",error:r.error}),n.timeline.error({handshakeError:r.error})):(n.abortConnecting(),n.handshakeCallbacks[r.action](r))};n.runner=n.strategy.connect(0,t)};n.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)};n.disconnectInternally=function(){this.abortConnecting();this.clearRetryTimer();this.clearUnavailableTimer();this.stopActivityCheck();this.connection&&this.abandonConnection().close()};n.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,encrypted:this.encrypted})};n.retryIn=function(n){var t=this;t.timeline.info({action:"retry",delay:n});n>0&&t.emit("connecting_in",Math.round(n/1e3));t.retryTimer=new Pusher.Timer(n||0,function(){t.disconnectInternally();t.connect()})};n.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)};n.setUnavailableTimer=function(){var n=this;n.unavailableTimer=new Pusher.Timer(n.options.unavailableTimeout,function(){n.updateState("unavailable")})};n.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()};n.sendActivityCheck=function(){var n=this;n.stopActivityCheck();n.send_event("pusher:ping",{});n.activityTimer=new Pusher.Timer(n.options.pongTimeout,function(){n.timeline.error({pong_timed_out:n.options.pongTimeout});n.retryIn(0)})};n.resetActivityCheck=function(){var n=this;n.stopActivityCheck();n.connection.supportsPing()||(n.activityTimer=new Pusher.Timer(n.activityTimeout,function(){n.sendActivityCheck()}))};n.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()};n.buildConnectionCallbacks=function(){var n=this;return{message:function(t){n.resetActivityCheck();n.emit("message",t)},ping:function(){n.send_event("pusher:pong",{})},error:function(t){n.emit("error",{type:"WebSocketError",error:t})},closed:function(){n.abandonConnection();n.shouldRetry()&&n.retryIn(1e3)}}};n.buildHandshakeCallbacks=function(n){var t=this;return Pusher.Util.extend({},n,{connected:function(n){t.activityTimeout=Math.min(t.options.activityTimeout,n.activityTimeout,n.connection.activityTimeout||Infinity);t.clearUnavailableTimer();t.setConnection(n.connection);t.socket_id=t.connection.id;t.updateState("connected",{socket_id:t.socket_id})}})};n.buildErrorCallbacks=function(){function t(t){return function(i){i.error&&n.emit("error",{type:"WebSocketError",error:i.error});t(i)}}var n=this;return{ssl_only:t(function(){n.encrypted=!0;n.updateStrategy();n.retryIn(0)}),refused:t(function(){n.disconnect()}),backoff:t(function(){n.retryIn(1e3)}),retry:t(function(){n.retryIn(0)})}};n.setConnection=function(n){this.connection=n;for(var t in this.connectionCallbacks)this.connection.bind(t,this.connectionCallbacks[t]);this.resetActivityCheck()};n.abandonConnection=function(){if(this.connection){for(var n in this.connectionCallbacks)this.connection.unbind(n,this.connectionCallbacks[n]);return n=this.connection,this.connection=null,n}};n.updateState=function(n,t){var i=this.state;this.state=n;i!==n&&(Pusher.debug("State changed",i+" -> "+n),this.timeline.info({state:n,params:t}),this.emit("state_change",{previous:i,current:n}),this.emit(n,t))};n.shouldRetry=function(){return this.state==="connecting"||this.state==="connected"};Pusher.ConnectionManager=t}.call(this),function(){function n(){Pusher.EventsDispatcher.call(this);var n=this;window.addEventListener!==void 0&&(window.addEventListener("online",function(){n.emit("online")},!1),window.addEventListener("offline",function(){n.emit("offline")},!1))}Pusher.Util.extend(n.prototype,Pusher.EventsDispatcher.prototype);n.prototype.isOnline=function(){return window.navigator.onLine===void 0?!0:window.navigator.onLine};Pusher.NetInfo=n;Pusher.Network=new n}.call(this),function(){function t(){this.reset()}var n=t.prototype;n.get=function(n){return Object.prototype.hasOwnProperty.call(this.members,n)?{id:n,info:this.members[n]}:null};n.each=function(n){var t=this;Pusher.Util.objectApply(t.members,function(i,r){n(t.get(r))})};n.setMyID=function(n){this.myID=n};n.onSubscription=function(n){this.members=n.presence.hash;this.count=n.presence.count;this.me=this.get(this.myID)};n.addMember=function(n){return this.get(n.user_id)===null&&this.count++,this.members[n.user_id]=n.user_info,this.get(n.user_id)};n.removeMember=function(n){var t=this.get(n.user_id);return t&&(delete this.members[n.user_id],this.count--),t};n.reset=function(){this.members={};this.count=0;this.me=this.myID=null};Pusher.Members=t}.call(this),function(){function t(n,t){Pusher.EventsDispatcher.call(this,function(t){Pusher.debug("No callbacks on "+n+" for "+t)});this.name=n;this.pusher=t;this.subscribed=!1}var n=t.prototype;Pusher.Util.extend(n,Pusher.EventsDispatcher.prototype);n.authorize=function(n,t){return t(!1,{})};n.trigger=function(n,t){if(n.indexOf("client-")!==0)throw new Pusher.Errors.BadEventName("Event '"+n+"' does not start with 'client-'");return this.pusher.send_event(n,t,this.name)};n.disconnect=function(){this.subscribed=!1};n.handleEvent=function(n,t){n.indexOf("pusher_internal:")===0?n==="pusher_internal:subscription_succeeded"&&(this.subscribed=!0,this.emit("pusher:subscription_succeeded",t)):this.emit(n,t)};n.subscribe=function(){var n=this;n.authorize(n.pusher.connection.socket_id,function(t,i){t?n.handleEvent("pusher:subscription_error",i):n.pusher.send_event("pusher:subscribe",{auth:i.auth,channel_data:i.channel_data,channel:n.name})})};n.unsubscribe=function(){this.pusher.send_event("pusher:unsubscribe",{channel:this.name})};Pusher.Channel=t}.call(this),function(){function n(n,t){Pusher.Channel.call(this,n,t)}var t=n.prototype;Pusher.Util.extend(t,Pusher.Channel.prototype);t.authorize=function(n,t){return new Pusher.Channel.Authorizer(this,this.pusher.config).authorize(n,t)};Pusher.PrivateChannel=n}.call(this),function(){function t(n,t){Pusher.PrivateChannel.call(this,n,t);this.members=new Pusher.Members}var n=t.prototype;Pusher.Util.extend(n,Pusher.PrivateChannel.prototype);n.authorize=function(n,t){var i=this;Pusher.PrivateChannel.prototype.authorize.call(i,n,function(n,r){if(!n){if(r.channel_data===void 0){Pusher.warn("Invalid auth response for channel '"+i.name+"', expected 'channel_data' field");t("Invalid auth response");return}var u=JSON.parse(r.channel_data);i.members.setMyID(u.user_id)}t(n,r)})};n.handleEvent=function(n,t){switch(n){case"pusher_internal:subscription_succeeded":this.members.onSubscription(t);this.subscribed=!0;this.emit("pusher:subscription_succeeded",this.members);break;case"pusher_internal:member_added":this.emit("pusher:member_added",this.members.addMember(t));break;case"pusher_internal:member_removed":var i=this.members.removeMember(t);i&&this.emit("pusher:member_removed",i);break;default:Pusher.PrivateChannel.prototype.handleEvent.call(this,n,t)}};n.disconnect=function(){this.members.reset();Pusher.PrivateChannel.prototype.disconnect.call(this)};Pusher.PresenceChannel=t}.call(this),function(){function t(){this.channels={}}var n=t.prototype;n.add=function(n,t){return this.channels[n]||(this.channels[n]=n.indexOf("private-")===0?new Pusher.PrivateChannel(n,t):n.indexOf("presence-")===0?new Pusher.PresenceChannel(n,t):new Pusher.Channel(n,t)),this.channels[n]};n.all=function(){return Pusher.Util.values(this.channels)};n.find=function(n){return this.channels[n]};n.remove=function(n){var t=this.channels[n];return delete this.channels[n],t};n.disconnect=function(){Pusher.Util.objectApply(this.channels,function(n){n.disconnect()})};Pusher.Channels=t}.call(this),function(){Pusher.Channel.Authorizer=function(n,t){this.channel=n;this.type=t.authTransport;this.options=t;this.authOptions=(t||{}).auth||{}};Pusher.Channel.Authorizer.prototype={composeQuery:function(n){var n="&socket_id="+encodeURIComponent(n)+"&channel_name="+encodeURIComponent(this.channel.name);for(var t in this.authOptions.params)n+="&"+encodeURIComponent(t)+"="+encodeURIComponent(this.authOptions.params[t]);return n},authorize:function(n,t){return Pusher.authorizers[this.type].call(this,n,t)}};var n=1;Pusher.auth_callbacks={};Pusher.authorizers={ajax:function(n,t){var i,r;i=Pusher.XHR?new Pusher.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");i.open("POST",this.options.authEndpoint,!0);i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(r in this.authOptions.headers)i.setRequestHeader(r,this.authOptions.headers[r]);return i.onreadystatechange=function(){if(i.readyState==4)if(i.status==200){var n,r=!1;try{n=JSON.parse(i.responseText);r=!0}catch(u){t(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+i.responseText)}r&&t(!1,n)}else Pusher.warn("Couldn't get auth info from your webapp",i.status),t(!0,i.status)},i.send(this.composeQuery(n)),i},jsonp:function(t,i){var r,u,f;this.authOptions.headers!==void 0&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");r=n.toString();n++;u=Pusher.Util.getDocument();f=u.createElement("script");Pusher.auth_callbacks[r]=function(n){i(!1,n)};f.src=this.options.authEndpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+r+"']")+this.composeQuery(t);r=u.getElementsByTagName("head")[0]||u.documentElement;r.insertBefore(f,r.firstChild)}}}.call(this)